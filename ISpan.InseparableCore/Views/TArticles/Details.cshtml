@model ISpan.InseparableCore.ViewModels.ArticleVm
<style>
	.btnEditComment {
	}

	.divContainer {
		display: flex;
		flex-direction: row;
		padding: 5px;
	}

	.divBorder {
		border-color: white;
		border-width: 3px;
		border-style: solid;
	}

	.divBlock {
		margin: 20px
	}

	.inDivPosition {
		position: relative;
		bottom: 0px;
		right: -20px;
	}
</style>

<h1>Details</h1>

<div>
    <h4>TArticles</h4>
    <hr />
    <dl class="row">
        <dt class = "col-sm-2">
            @Html.DisplayNameFor(model => model.FArticleTitle)
        </dt>
        <dd class = "col-sm-10">
            @Html.DisplayFor(model => model.FArticleTitle)
        </dd>
        <dt class = "col-sm-2">
            @Html.DisplayNameFor(model => model.ArticleCategory)
        </dt>
        <dd class = "col-sm-10">
            @Html.DisplayFor(model => model.ArticleCategory)
        </dd>
        <dt class = "col-sm-2">
            @Html.DisplayNameFor(model => model.MemberName)
        </dt>
        <dd class = "col-sm-10">
            @Html.DisplayFor(model => model.MemberName)
        </dd>
        <dt class = "col-sm-2">
            @Html.DisplayNameFor(model => model.PostingDate)
        </dt>
        <dd class = "col-sm-10">
            @Html.DisplayFor(model => model.PostingDate)
        </dd>
        <dt class = "col-sm-2">
            @Html.DisplayNameFor(model => model.ModifiedDate)
        </dt>
        <dd class = "col-sm-10">
            @Html.DisplayFor(model => model.ModifiedDate)
        </dd>
        <dt class = "col-sm-2">
            @Html.DisplayNameFor(model => model.FArticleLikes)
        </dt>
        <dd class = "col-sm-10">
            @Html.DisplayFor(model => model.FArticleLikes)
        </dd>
        <dt class = "col-sm-2">
            @Html.DisplayNameFor(model => model.FArticleClicks)
        </dt>
        <dd class = "col-sm-10">
            @Html.DisplayFor(model => model.FArticleClicks)
        </dd>
        <dt class = "col-sm-2">
            @Html.DisplayNameFor(model => model.FArticleContent)
        </dt>
        <dd class = "col-sm-10">
            @Html.DisplayFor(model => model.FArticleContent)
        </dd>
    </dl>
</div>
<div id="divComment"></div>
<div class="form-group">
	<select name="FMemberId" class="" id="FMemberId" asp-items="ViewBag.FMemberId"></select>
</div>

<div class="divContainer">
	<div class="input-group">
		<span class="input-group-text">評論</span>
		<textarea class="form-control" id="FCommentContent" aria-label="With textarea"></textarea>
	</div>
	<div>
		<button type="button" id="btnComment" class="btn btn-secondary">留言</button>
	</div>
</div>

<div>
    <a asp-action="Edit" asp-route-id="@Model?.FArticleId">Edit</a> |
    <a asp-action="Index">Back to List</a>
</div>
@section Scripts{
	<script>
		//送出評論及展示評論ajax函數
		function CommentDetail(FCommentId, FMemberId, FArticleId, FCommentContent) {
			$.ajax({
				method: "post",
				url: "/TComments/ArticleComment",
				data: { FCommentId, FMemberId, FArticleId, FCommentContent },
				success: function (data) {
					let context = JSON.parse(data);
					//alert(data)
					let memberId = $("#FMemberId").find(":selected").attr("value")

					$("#divComment").html("")
					$.each(context, function (index, value) {
						if (value.FMemberId == memberId) {
							$("#divComment").append(`
									<div class=" divBorder">
										<div style="font-size:large; margin:10px 0 0 10px" id="F${value.FCommentId}">
											<div style="margin:5px" >
												${value.MemberName}	 ${value.PostingDate}
									<button type="button" class="btn btn-secondary btnEditComment" value="${value.FCommentId}">修改</button>
											</div>
											<hr style="margin:0"/>
											<div style="margin:5px" id="commentText">
												${value.FCommentContent}
											</div>
										</div>
									</div>`
							)
						}
						else {
							$("#divComment").append(`
									<div class=" divBorder">
										<div style="font-size:large; margin:10px 0 0 10px" >
											<div style="margin:5px">
												${value.MemberName}	 ${value.PostingDate}
											</div>
											<hr style="margin:0"/>
											<div style="margin:5px">${value.FCommentContent}</div>
										</div>
									</div>`
							)
						}

					})
				},
				error: function (jqXHR, textStatus, errorThrown) {
				},
			})
		}
		//開始編輯評論，生成編輯textarea
		$(document).on('click', '.btnEditComment', function () {
			let commentId = $(this).attr("value")
			let text = $.trim($(`#F${commentId} #commentText`).text())
			//alert(commentId+text)
			$(`#F${commentId}`).html(`
				<div class="divContainer">
					<div class="input-group">
						<span class="input-group-text">評論</span>
						<textarea class="form-control" id="FCommentContent" aria-label="With textarea">${text}</textarea>
					</div>
					<div>
						<button type="button" id="btnComment" class="btn btn-secondary" value="${commentId}">留言</button>
					</div>
				</div>
					`)
		});

		//單選按鈕組，按下時改變顏色
		$('.btn').click(function () {
			$('.btn-primary').addClass('btn-secondary');
			$('.btn-secondary').removeClass('btn-primary');

			$(this).removeClass('btn-secondary');
			$(this).addClass('btn-primary');
		});
		//送出評論
		$(document).on('click', '#btnComment', function () {
			let commentId = $(this).attr("value")
			let memberId = $("#FMemberId").find(":selected").attr("value")
			let movieId = @Model.FArticleId
			let comment = $("#FCommentContent").val();
			alert(commentId)
			CommentDetail(commentId, memberId, movieId, comment)
		})
		//展示評論
		CommentDetail(0, 0, @Model.FArticleId, "")
	</script>

}
